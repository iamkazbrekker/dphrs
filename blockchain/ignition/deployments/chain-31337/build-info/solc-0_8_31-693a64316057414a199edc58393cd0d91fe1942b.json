{
  "_format": "hh3-sol-build-info-1",
  "id": "solc-0_8_31-693a64316057414a199edc58393cd0d91fe1942b",
  "solcVersion": "0.8.31",
  "solcLongVersion": "0.8.31+commit.fd3a2265",
  "userSourceNameMap": {
    "contracts/PatientRegistry.sol": "project/contracts/PatientRegistry.sol"
  },
  "input": {
    "language": "Solidity",
    "settings": {
      "evmVersion": "osaka",
      "optimizer": {
        "enabled": true,
        "runs": 200
      },
      "outputSelection": {
        "*": {
          "": [
            "ast"
          ],
          "*": [
            "abi",
            "evm.bytecode",
            "evm.deployedBytecode",
            "evm.methodIdentifiers",
            "metadata"
          ]
        }
      },
      "remappings": []
    },
    "sources": {
      "project/contracts/PatientRegistry.sol": {
        "content": "//SPDX-License-Identifier: MIT\r\npragma solidity ^0.8.31;\r\n\r\ncontract PatientsRegistry {\r\n\r\n    //Structs\r\n    struct MedicalRecord {\r\n        uint256 timestamp;\r\n        string recordType;\r\n        string description;\r\n        string doctorName;\r\n        string institution;\r\n        address addedBy;\r\n    }\r\n\r\n    struct Patient{\r\n        bool registered;\r\n        uint256 dateOfBirth;\r\n        string name;\r\n        string bloodType;\r\n        string gender;\r\n        MedicalRecord[] records;\r\n    }\r\n\r\n    struct Institution{\r\n        bool registered;\r\n        string name;\r\n        string institutionType;\r\n        string Location;\r\n        string registrationId;\r\n    }\r\n\r\n    struct AccessLog {\r\n        address institution;\r\n        string institutionName;\r\n        uint256 timestamp;\r\n        string action;\r\n    }\r\n\r\n    //mappings\r\n    mapping (address => Patient) private patients;\r\n    mapping(address => Institution) private institutions;\r\n    mapping(address => AccessLog[]) private logs;\r\n\r\n    event PatientRegistered(address indexed patient, string name, uint256 timestamp);\r\n    event RecordAdded(address indexed patient, string recordType, address addedBy, uint256 timestamp);\r\n    event InstitutionRegistered(address indexed institution, string name, uint256 timestamp);\r\n    event PatientDataAccessed(address indexed patient, address indexed institution, string action, uint256 timestamp);\r\n\r\n\r\n    modifier registered(){\r\n        require(patients[msg.sender].registered, \"Not registered\");\r\n        _;\r\n    }\r\n    modifier notRegistered(){\r\n        require(!patients[msg.sender].registered, \"Already registered\");\r\n        _;\r\n    }\r\n    modifier onlyInstitution(){\r\n        require(institutions[msg.sender].registered, \"Institution not registered\");\r\n        _;\r\n    }\r\n    modifier notInstitution(){\r\n        require(!institutions[msg.sender].registered, \"Institution not registered\");\r\n        _;\r\n    }\r\n\r\n    \r\n    //patient registeration\r\n    function register(\r\n    string calldata _name, \r\n    uint256 _dateOfBirth, \r\n    string calldata _bloodType, \r\n    string calldata _gender) external notRegistered{\r\n        require (bytes(_name).length > 0, \"Name is required\");\r\n        require(_dateOfBirth > 0, \"Date of birth is required\");\r\n        require(bytes(_gender).length>0,\"Gender is required\");\r\n\r\n        Patient storage p = patients[msg.sender];\r\n        p.registered = true;\r\n        p.name = _name;\r\n        p.dateOfBirth = _dateOfBirth;\r\n        p.bloodType = _bloodType;\r\n        p.gender = _gender;\r\n\r\n        emit PatientRegistered(msg.sender,_name, block.timestamp);\r\n    }\r\n\r\n    //patient adds medical record\r\n    function addMedicalRecord(\r\n        string calldata _recordType,\r\n        string calldata _description,\r\n        string calldata _doctorName,\r\n        string calldata _institution\r\n    ) external registered{\r\n        require(bytes(_recordType).length > 0, \"Record type required\");\r\n        require(bytes(_description).length > 0, \"Description is required\");\r\n        require(bytes(_doctorName).length > 0, \"Doctor name is required\");\r\n        require(bytes(_institution).length > 0, \"Institution name is required\");\r\n\r\n        patients[msg.sender].records.push(MedicalRecord({\r\n            timestamp: block.timestamp,\r\n            recordType: _recordType,\r\n            description: _description,\r\n            doctorName: _doctorName,\r\n            institution: _institution,\r\n            addedBy: address(0)\r\n        }));\r\n\r\n        emit RecordAdded(msg.sender, _recordType, address(0), block.timestamp);\r\n    }\r\n\r\n    //retreiving data for patient\r\n    function getMyProfile() external view registered returns(string memory name, uint256 dateOfBirth, string memory bloodType, string memory gender, uint256 recordCount){\r\n        Patient storage p = patients[msg.sender];\r\n        return (p.name, p.dateOfBirth, p.bloodType, p.gender, p.records.length);\r\n    }\r\n\r\n    function getMedicalRecord(uint256 index) external view registered returns(\r\n        uint256 timestamp,\r\n        string memory recordType,\r\n        string memory description,\r\n        string memory doctorName,\r\n        string memory institution,\r\n        address addedBy\r\n    ){\r\n        Patient storage p = patients[msg.sender];\r\n        require(index < p.records.length, \"Index out of bounds\");\r\n        MedicalRecord storage r = p.records[index];\r\n        return (r.timestamp, r.recordType, r.description, r.doctorName, r.institution, r.addedBy);\r\n    }\r\n\r\n    function getRecordCount() external view registered returns(uint256){\r\n        return patients[msg.sender].records.length;\r\n    }\r\n\r\n    function isRegistered() external view returns(bool){\r\n        return patients[msg.sender].registered;\r\n    }\r\n\r\n    function registerInstitution(\r\n        string calldata _name,\r\n        string calldata _institutionType,\r\n        string calldata _location,\r\n        string calldata _registrationId\r\n    ) external notInstitution{\r\n        require(bytes(_name).length > 0, \"Institution name required\");\r\n        require(bytes(_registrationId).length > 0, \"Registration ID required\");\r\n        Institution storage insti = institutions[msg.sender];\r\n        insti.registered = true;\r\n        insti.name = _name;\r\n        insti.institutionType = _institutionType;\r\n        insti.Location = _location;\r\n        insti.registrationId = _registrationId;\r\n\r\n        emit InstitutionRegistered(msg.sender, _name, block.timestamp);\r\n    }\r\n\r\n    function isInstitutionRegistered() external view returns(bool){\r\n        return institutions[msg.sender].registered;\r\n    }\r\n\r\n    function getInstitutionName() external view returns(string memory){\r\n        return institutions[msg.sender].name;\r\n    }\r\n\r\n    //institutions read patient data\r\n    function getPatientBasicInfo(address _patient) external onlyInstitution returns(\r\n        string memory name,\r\n        uint256 _dateOfBirth,\r\n        string memory bloodType,\r\n        string memory gender,\r\n        uint256 recordCount\r\n    ){\r\n        require(patients[_patient].registered, \"Patient not found\");\r\n\r\n        logs[_patient].push(AccessLog({\r\n            institution: msg.sender,\r\n            institutionName: institutions[msg.sender].name,\r\n            timestamp: block.timestamp,\r\n            action: \"READ\"\r\n        }));\r\n        emit PatientDataAccessed(_patient, msg.sender, \"READ\", block.timestamp);\r\n\r\n        Patient storage p = patients[_patient];\r\n        return(p.name, p.dateOfBirth, p.bloodType, p.gender, p.records.length);\r\n    }\r\n\r\n    function getPatientRecord(address _patient, uint256 index) external view onlyInstitution returns(\r\n        uint256 timestamp,\r\n        string memory recordType,\r\n        string memory description,\r\n        string memory doctorName,\r\n        string memory institution,\r\n        address addedBy\r\n    ){\r\n        require(patients[_patient].registered, \"Patient not found\");\r\n        Patient storage p = patients[_patient];\r\n        require(index < p.records.length, \"Index out of bounds\");\r\n        MedicalRecord storage r = p.records[index];\r\n        return (r.timestamp, r.recordType, r.description, r.doctorName, r.institution, r.addedBy);\r\n    }\r\n\r\n    //institution adds data\r\n    function addRecordForPatient(\r\n        address _patient,\r\n        string calldata _recordType,\r\n        string calldata _description,\r\n        string calldata _doctorName\r\n    ) external onlyInstitution{\r\n        require(patients[_patient].registered, \"Patient not registered\");\r\n        require(bytes(_recordType).length > 0, \"Record type required\");\r\n        require(bytes(_description).length > 0, \"Description required\");\r\n\r\n        patients[_patient].records.push(MedicalRecord({\r\n            timestamp: block.timestamp,\r\n            recordType: _recordType,\r\n            description: _description,\r\n            doctorName: _doctorName,\r\n            institution: institutions[msg.sender].name,\r\n            addedBy: msg.sender\r\n        }));\r\n\r\n        logs[_patient].push(AccessLog({\r\n            institution: msg.sender,\r\n            institutionName: institutions[msg.sender].name,\r\n            timestamp: block.timestamp,\r\n            action: \"WRITE\"\r\n        }));\r\n        emit RecordAdded(_patient, _recordType, msg.sender, block.timestamp);\r\n        emit PatientDataAccessed(_patient, msg.sender, \"WRITE\", block.timestamp);\r\n    }\r\n\r\n    //patient view access logs\r\n    function getAccessLogCount() external view registered returns(uint256){\r\n        return logs[msg.sender].length;\r\n    }\r\n    function getAccessLog(uint256 index) external view registered returns(\r\n        address institution,\r\n        string memory institutionName,\r\n        uint256 timestamp,\r\n        string memory action\r\n    ){\r\n        AccessLog[] storage al = logs[msg.sender];\r\n        require(index < al.length, \"Index out of bound\");\r\n        AccessLog storage log = al[index];\r\n        return(log.institution, log.institutionName, log.timestamp, log.action);\r\n    }\r\n\r\n}"
      }
    }
  }
}